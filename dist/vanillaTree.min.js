document.addEventListener("DOMContentLoaded",function(){let e={checkboxMode:"all",useIcons:!1,populateCheckboxSelection:!0,useServerData:!1,maxRecursionDepth:500,treeModel:"nested"};function t(n){let d=document.createElement("div");d.className="node",d.id=n.id;let i=document.createElement("div");i.classList.add("toggle"),Array.isArray(n.children)&&n.children.length>0?(i.innerHTML='<svg class="toggle" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="6 9 12 15 18 9"/></svg>',i.addEventListener("click",function(){this.classList.toggle("rotated"),function e(t){let n=t.children,d=0;for(let i=0;i<n.length;i++)d+=n[i].offsetHeight;if("0px"===t.style.maxHeight){t.style.maxHeight=d+"px";let r=t.parentElement.closest(".children");for(;r;)r.style.maxHeight=parseFloat(r.style.maxHeight)+d+"px",r=r.parentElement.closest(".children")}else{t.style.maxHeight="0";let l=t.parentElement.closest(".children");for(;l;)l.style.maxHeight=parseFloat(l.style.maxHeight)-d+"px",l=l.parentElement.closest(".children")}}(d.querySelector(".children"))})):i.innerHTML='<svg class="toggle" viewBox="0 0 24 24" fill="none" stroke="none" stroke-width="0"></svg>',d.appendChild(i);let r="all"===e.checkboxMode||"leaf"===e.checkboxMode&&(!n.children||0===n.children.length);if(r){let l=document.createElement("input");l.type="checkbox",l.style.marginRight="10px",l.setAttribute("data-indeterminate","false"),d.appendChild(l),l.addEventListener("change",function(){if(e.populateCheckboxSelection){if("true"===this.getAttribute("data-indeterminate")){let t=this.closest(".node").querySelectorAll('.children input[type="checkbox"]');t.forEach(e=>{e.checked=!1,e.indeterminate=!1})}this.setAttribute("data-indeterminate",this.indeterminate?"true":"false"),function t(n,d=0){let i=n.closest(".node").parentElement.closest(".node");if(!i||d>=e.maxRecursionDepth){console.log("Max recursion depth reached or no parent found");return}let r=i.querySelector('input[type="checkbox"]');if(!r){console.log("No checkbox found at this level");return}let l=i.querySelectorAll('.children input[type="checkbox"]'),a=!0,o=!1;l.forEach(function(e){e.checked?o=!0:a=!1}),a?(r.indeterminate=!1,r.checked=!0):o?(r.indeterminate=!0,r.checked=!1):(r.indeterminate=!1,r.checked=!1),r.setAttribute("data-indeterminate",r.indeterminate?"true":"false"),t(r,d+1)}(this)}let n=function e(){let t=document.querySelectorAll('.node input[type="checkbox"]:checked'),n=Array.from(t).map(e=>e.closest(".node").id);return n}();console.log("Selected Node IDs: "+n.join(", ")),e.useServerData&&function e(t){fetch("/selectednodes",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({selectedIds:t})}).then(e=>e.text()).then(e=>{try{let t=JSON.parse(e);console.log("Success:",t)}catch(n){console.error("Error parsing JSON:",n)}}).catch(e=>{console.error("Error:",e)})}(n)})}if(e.useIcons){let a=document.createElement("div");a.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M 22 18 V 10 a 2 2 0 0 0 -2 -2 h -7 c -2 0 -1 -2 -3 -2 H 4 a 2 2 0 0 0 -2 2 v 10 a 2 2 0 0 0 2 2 h 16 a 2 2 0 0 0 2 -2 z"/></svg>',a.classList.add("icon"),d.appendChild(a)}let o=document.createElement("span");if(o.textContent=n.name,d.appendChild(o),Array.isArray(n.children)&&n.children.length>0){let c=document.createElement("div");c.className="children",c.style.overflow="hidden",c.style.maxHeight="0",c.style.transition="max-height 0.15s ease-in-out",n.children.forEach(e=>c.appendChild(t(e))),d.appendChild(c)}return d}function n(n){let d=document.getElementById("vanillaTree");if(d.innerHTML="","flat"===e.treeModel){let i=function e(t){let n=null,d={};return t.forEach(e=>{d[e.id]={...e,children:[]}}),t.forEach(e=>{null===e.parent_id?n=d[e.id]:d[e.parent_id].children.push(d[e.id])}),n}(n);d.appendChild(t(i))}else d.appendChild(t(n))}if("leaf"===e.checkboxMode&&(e.populateCheckboxSelection=!1),e.useServerData)!function t(){let d="flat"===e.treeModel?"/flatnodes":"/treenodes";fetch(d).then(e=>{if(!e.ok)throw Error("Network response was not ok");return e.json()}).then(e=>{n(e)}).catch(e=>{console.error("Failed to load tree data from server, using hardcoded data:",e),n(dataToUse)})}();else{let d="flat"===e.treeModel?[{id:"r1",name:"Root Node (js, flat)",parent_id:null},{id:"c1",name:"Child Node 1",parent_id:"r1"},{id:"gc1",name:"Grandchild Node 1",parent_id:"c1"},{id:"ggc1",name:"Great-Grandchild Node 1",parent_id:"gc1"},{id:"ggc2",name:"Great-Grandchild Node 2",parent_id:"gc1"},{id:"c2",name:"Child Node 2",parent_id:"r1"},{id:"gc2",name:"Grandchild Node 2",parent_id:"c2"},{id:"gc3",name:"Grandchild Node 3",parent_id:"c2"},{id:"ggc3",name:"Great-Grandchild Node 3",parent_id:"gc3"},{id:"c3",name:"Child Node 3",parent_id:"r1"}]:{id:"r1",name:"Root Node (js, nested)",children:[{id:"c1",name:"Child Node 1",children:[{id:"gc1",name:"Grandchild Node 1",children:[{id:"ggc1",name:"Great-Grandchild Node 1",children:[]},{id:"ggc2",name:"Great-Grandchild Node 2",children:[]}]}]},{id:"c2",name:"Child Node 2",children:[{id:"gc2",name:"Grandchild Node 2",children:[]},{id:"gc3",name:"Grandchild Node 3",children:[{id:"ggc3",name:"Great-Grandchild Node 3",children:[]}]}]},{id:"c3",name:"Child Node 3",children:[]}]};n(d)}});